<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lemon.mapper.OutboundOrderPackageMapper">
  <resultMap id="BaseResultMap" type="com.lemon.domain.OutboundOrderPackage">
    <!--@mbg.generated-->
    <!--@Table outbound_order_package-->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="package_code" jdbcType="VARCHAR" property="packageCode" />
    <result column="outbound_order_detail_id" jdbcType="BIGINT" property="outboundOrderDetailId" />
    <result column="sku_id" jdbcType="BIGINT" property="skuId" />
    <result column="package_count" jdbcType="INTEGER" property="packageCount" />
    <result column="package_emp_id" jdbcType="INTEGER" property="packageEmpId" />
    <result column="package_time" jdbcType="TIMESTAMP" property="packageTime" />
    <result column="saas_id" jdbcType="VARCHAR" property="saasId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="create_by" jdbcType="VARCHAR" property="createBy" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="update_by" jdbcType="VARCHAR" property="updateBy" />
    <result column="is_del" jdbcType="INTEGER" property="isDel" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated-->
    id, package_code, outbound_order_detail_id, sku_id, package_count, package_emp_id, 
    package_time, saas_id, create_time, create_by, update_time, update_by, is_del
  </sql>

  <select id="getPageAll" resultType="com.lemon.domain.vo.OutboundOrderPackageVo">
    SELECT
      -- 打包单表字段
      oop.package_code,
      oop.package_status,
      oop.create_by,
      oop.create_time,
      oop.package_emp_id,
      oop.package_count,

      -- 明细单数据
      ood.weight,
      ood.volume,
      ood.pick_emp_id AS pickEmpId,
      ood.max_count AS maxCount,

      -- SKU表数据
      s.id,
      s.title,
      s.spu_id,
      s.code,

      -- 出库单表数据
      oo.customer_name,
      oo.invoice_code

    FROM outbound_order_package oop
-- 关联出库单明细表
           LEFT JOIN outbound_order_details ood ON oop.outbound_order_detail_id = ood.id
-- 关联SKU表
           LEFT JOIN sku s ON oop.sku_id = s.id
-- 关联出库单表（通过明细表关联）
           LEFT JOIN outbound_order oo ON ood.outbound_order_id = oo.id
    WHERE oop.is_del = 1
      AND (
      -- 商品名称条件（模糊匹配）
      (:title IS NULL OR s.title LIKE CONCAT('%', :title, '%'))
        AND
        -- 打包状态条件
      (:packageStatus IS NULL OR oop.package_status = :packageStatus)
      )
    ORDER BY oop.create_time DESC;
    </select>
</mapper>