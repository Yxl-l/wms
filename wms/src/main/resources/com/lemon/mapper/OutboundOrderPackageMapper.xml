<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lemon.mapper.OutboundOrderPackageMapper">
  <resultMap id="BaseResultMap" type="com.lemon.domain.OutboundOrderPackage">
    <!--@mbg.generated-->
    <!--@Table outbound_order_package-->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="package_code" jdbcType="VARCHAR" property="packageCode" />
    <result column="outbound_order_detail_id" jdbcType="BIGINT" property="outboundOrderDetailId" />
    <result column="sku_id" jdbcType="BIGINT" property="skuId" />
    <result column="package_count" jdbcType="INTEGER" property="packageCount" />
    <result column="package_emp_id" jdbcType="INTEGER" property="packageEmpId" />
    <result column="package_time" jdbcType="TIMESTAMP" property="packageTime" />
    <result column="saas_id" jdbcType="VARCHAR" property="saasId" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="create_by" jdbcType="VARCHAR" property="createBy" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="update_by" jdbcType="VARCHAR" property="updateBy" />
    <result column="is_del" jdbcType="INTEGER" property="isDel" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated-->
    id, package_code, outbound_order_detail_id, sku_id, package_count, package_emp_id, 
    package_time, saas_id, create_time, create_by, update_time, update_by, is_del
  </sql>

  <select id="getPageAll" resultType="com.lemon.domain.vo.OutboundOrderPackageVo">

    SELECT
    -- 明细单数据
    ood.weight,
    ood.volume,
    ood.pick_emp_id AS pickEmpId,
    ood.max_count AS maxCount,

    -- SKU表数据
    s.id AS skuId,
    s.title,
    s.spu_id AS spuId,
    s.code,

    -- 出库单表数据
    oo.customer_name AS customerName,
    oo.invoice_code AS invoiceCode,
    oo.id AS outboundOrderId,

    -- 打包单表数据
    oop.create_by AS createBy,
    oop.create_time AS createTime,
    oop.package_emp_id AS packageEmpId,
    oop.package_count AS packageCount,
    oop.package_status AS packageStatus,
    oop.package_code AS packageCode,
    oop.package_time AS packageTime,
    oop.id

    FROM outbound_order_package oop
    LEFT JOIN outbound_order_details ood ON oop.outbound_order_detail_id = ood.id
    LEFT JOIN sku s ON oop.sku_id = s.id
    LEFT JOIN outbound_order oo ON ood.outbound_order_id = oo.id
    WHERE 1=1
    <if test="title != null and title != ''">
      AND s.title LIKE CONCAT('%', #{title}, '%')
    </if>
    <if test="packageStatus != null">
      AND oop.package_status = #{packageStatus}
    </if>
    <if test="packageCode != null and packageCode != ''">
      AND oop.package_code LIKE CONCAT('%', #{packageCode}, '%')
    </if>
    <if test="invoiceCode != null and invoiceCode != ''">
      AND oo.invoice_code LIKE CONCAT('%', #{invoiceCode}, '%')
    </if>
    ORDER BY oop.create_time DESC
    </select>
</mapper>